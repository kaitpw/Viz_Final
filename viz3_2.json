{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "data": [
    {
      "name": "source_1",
      "values": [
        {"CDD65": 2168.175713432476, "state_name": "Alabama", "STATE_FIPS": 1},
        {"CDD65": 2.248913525233516, "state_name": "Alaska", "STATE_FIPS": 2},
        {"CDD65": 4426.241902853607, "state_name": "Arizona", "STATE_FIPS": 4},
        {
          "CDD65": 1720.0712340105179,
          "state_name": "Arkansas",
          "STATE_FIPS": 5
        },
        {
          "CDD65": 1537.5816716206534,
          "state_name": "California",
          "STATE_FIPS": 6
        },
        {"CDD65": 908.1258988776257, "state_name": "Colorado", "STATE_FIPS": 8},
        {
          "CDD65": 984.202710807875,
          "state_name": "Connecticut",
          "STATE_FIPS": 9
        },
        {
          "CDD65": 1319.124994462421,
          "state_name": "Delaware",
          "STATE_FIPS": 10
        },
        {
          "CDD65": 1536.2491612597878,
          "state_name": "District of Columbia",
          "STATE_FIPS": 11
        },
        {"CDD65": 4175.723275083974, "state_name": "Florida", "STATE_FIPS": 12},
        {"CDD65": 2016.856400127222, "state_name": "Georgia", "STATE_FIPS": 13},
        {"CDD65": 4154.25655532776, "state_name": "Hawaii", "STATE_FIPS": 15},
        {"CDD65": 661.8884192030474, "state_name": "Idaho", "STATE_FIPS": 16},
        {
          "CDD65": 1095.064843514459,
          "state_name": "Illinois",
          "STATE_FIPS": 17
        },
        {
          "CDD65": 1064.8791745647907,
          "state_name": "Indiana",
          "STATE_FIPS": 18
        },
        {"CDD65": 906.2916194788645, "state_name": "Iowa", "STATE_FIPS": 19},
        {"CDD65": 1404.800443002388, "state_name": "Kansas", "STATE_FIPS": 20},
        {
          "CDD65": 1314.096591111827,
          "state_name": "Kentucky",
          "STATE_FIPS": 21
        },
        {
          "CDD65": 2967.3193716690635,
          "state_name": "Louisiana",
          "STATE_FIPS": 22
        },
        {"CDD65": 494.8828034151036, "state_name": "Maine", "STATE_FIPS": 23},
        {
          "CDD65": 1399.891602921128,
          "state_name": "Maryland",
          "STATE_FIPS": 24
        },
        {
          "CDD65": 838.2933411465791,
          "state_name": "Massachusetts",
          "STATE_FIPS": 25
        },
        {
          "CDD65": 738.3735906800308,
          "state_name": "Michigan",
          "STATE_FIPS": 26
        },
        {
          "CDD65": 707.705974018577,
          "state_name": "Minnesota",
          "STATE_FIPS": 27
        },
        {
          "CDD65": 2374.11335532445,
          "state_name": "Mississippi",
          "STATE_FIPS": 28
        },
        {"CDD65": 1378.3307634711, "state_name": "Missouri", "STATE_FIPS": 29},
        {"CDD65": 376.5465257650059, "state_name": "Montana", "STATE_FIPS": 30},
        {
          "CDD65": 1103.3060156439267,
          "state_name": "Nebraska",
          "STATE_FIPS": 31
        },
        {"CDD65": 3101.385385459479, "state_name": "Nevada", "STATE_FIPS": 32},
        {
          "CDD65": 669.926349785572,
          "state_name": "New Hampshire",
          "STATE_FIPS": 33
        },
        {
          "CDD65": 1206.9959056352463,
          "state_name": "New Jersey",
          "STATE_FIPS": 34
        },
        {
          "CDD65": 1494.940453963975,
          "state_name": "New Mexico",
          "STATE_FIPS": 35
        },
        {
          "CDD65": 1059.3059226262537,
          "state_name": "New York",
          "STATE_FIPS": 36
        },
        {
          "CDD65": 1645.5974468884503,
          "state_name": "North Carolina",
          "STATE_FIPS": 37
        },
        {
          "CDD65": 566.0483780533774,
          "state_name": "North Dakota",
          "STATE_FIPS": 38
        },
        {"CDD65": 976.880768694477, "state_name": "Ohio", "STATE_FIPS": 39},
        {
          "CDD65": 1907.9283167277354,
          "state_name": "Oklahoma",
          "STATE_FIPS": 40
        },
        {"CDD65": 369.000248113651, "state_name": "Oregon", "STATE_FIPS": 41},
        {
          "CDD65": 985.8227554861122,
          "state_name": "Pennsylvania",
          "STATE_FIPS": 42
        },
        {
          "CDD65": 895.3805766621499,
          "state_name": "Rhode Island",
          "STATE_FIPS": 44
        },
        {
          "CDD65": 2082.233713848869,
          "state_name": "South Carolina",
          "STATE_FIPS": 45
        },
        {
          "CDD65": 833.1243959363253,
          "state_name": "South Dakota",
          "STATE_FIPS": 46
        },
        {
          "CDD65": 1539.3683340098457,
          "state_name": "Tennessee",
          "STATE_FIPS": 47
        },
        {"CDD65": 3129.7704514336797, "state_name": "Texas", "STATE_FIPS": 48},
        {"CDD65": 1315.0435229328846, "state_name": "Utah", "STATE_FIPS": 49},
        {"CDD65": 568.7635084782916, "state_name": "Vermont", "STATE_FIPS": 50},
        {
          "CDD65": 1412.2708663396118,
          "state_name": "Virginia",
          "STATE_FIPS": 51
        },
        {
          "CDD65": 290.7831276220952,
          "state_name": "Washington",
          "STATE_FIPS": 53
        },
        {
          "CDD65": 978.2441005493359,
          "state_name": "West Virginia",
          "STATE_FIPS": 54
        },
        {
          "CDD65": 629.9659631366102,
          "state_name": "Wisconsin",
          "STATE_FIPS": 55
        },
        {"CDD65": 509.0944392304503, "state_name": "Wyoming", "STATE_FIPS": 56}
      ]
    },
    {
      "name": "source_0",
      "url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/us-10m.json",
      "format": {"type": "topojson", "feature": "states"},
      "transform": [
        {
          "type": "lookup",
          "from": "source_1",
          "fields": ["id"],
          "key": "STATE_FIPS",
          "values": ["CDD65", "state_name"]
        },
        {
          "type": "filter",
          "expr": "isValid(datum[\"CDD65\"]) && isFinite(+datum[\"CDD65\"])"
        }
      ]
    },
    {
      "name": "source_0_color_domain_CDD65",
      "source": "source_0",
      "transform": [
        {"type": "formula", "expr": "+datum['CDD65']", "as": "CDD65"},
        {
          "type": "aggregate",
          "groupby": [],
          "fields": ["CDD65", "CDD65"],
          "ops": ["min", "max"],
          "as": ["min", "max"]
        }
      ]
    }
  ],
  "marks": [
    {
      "type": "shape",
      "name": "marks",
      "from": {"data": "source_0"},
      "encode": {
        "update": {
          "fill": {"field": "CDD65", "scale": "color"},
          "tooltip": {
            "signal": "{\"State\": isValid(datum[\"state_name\"]) ? datum[\"state_name\"] : \"\"+datum[\"state_name\"], \"Avg CDD\": format(datum[\"CDD65\"], \".2f\")}"
          },
          "stroke": {"value": "white"}
        }
      },
      "transform": [{"type": "geoshape", "projection": "projection"}],
      "style": ["geoshape"]
    }
  ],
  "scales": [
    {
      "name": "color",
      "type": "linear",
      "domain": [
        {"signal": "(data(\"source_0_color_domain_CDD65\")[0] || {}).min"},
        {"signal": "(data(\"source_0_color_domain_CDD65\")[0] || {}).max"}
      ],
      "range": {"scheme": "purpleblue"},
      "interpolate": "hcl",
      "zero": false
    }
  ],
  "projections": [
    {
      "name": "projection",
      "size": {"signal": "[width, height]"},
      "type": "albersUsa",
      "fit": {"signal": "data('source_0')"}
    }
  ],
  "title": {
    "text": "Annual Cooling Degree Days (CDD) by State ",
    "align": "center",
    "color": "black",
    "fontSize": 15,
    "fontWeight": "bold",
    "frame": "group"
  },
  "legends": [
    {
      "title": "CDD/Household",
      "fill": "color",
      "gradientLength": {"signal": "clamp(height, 64, 200)"}
    }
  ],
  "padding": 5,
  "width": 350,
  "style": "view",
  "background": "white",
  "height": 250
}